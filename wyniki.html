<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hall Of Fame - Wyniki</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* {margin:0; padding:0; box-sizing:border-box;}
body {
    font-family: 'Montserrat', sans-serif;
    background: radial-gradient(circle at top, #1b1f2b, #0b0e14);
    color: #e6e8ee;
    min-height: 100vh;
}
header {text-align: center; margin: 40px 0 30px; padding: 0 15px;}
header h1 {font-size: 42px; font-weight: 700; color: #9aa2ff;}
header .subtitle {font-size: 20px; color: #7fd1ff; margin-top: 5px;}

.results-hero {display: flex; flex-direction: column; align-items: center; padding: 20px;}

.results-grid {
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 30px; 
    width: 100%; 
    max-width: 1200px;
}

.result-card {
    background: rgba(21,25,35,0.95); 
    padding: 30px; 
    border-radius: 20px; 
    text-align: center; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.4); 
    border: 1px solid rgba(127, 209, 255, 0.1);
}

.result-card h3 {font-size: 16px; color: #7fd1ff; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px;}
.result-card h4 {font-size: 22px; color: #fff; margin-bottom: 20px; font-weight: 600; line-height: 1.3;}
.result-card .winner {
    font-size: 26px; 
    color: #9aa2ff; 
    font-weight: 700; 
    padding: 10px 20px; 
    border: 2px dashed #9aa2ff; 
    border-radius: 12px; 
    display: inline-block;
    background: rgba(154, 162, 255, 0.1);
    word-break: break-word; /* Żeby długie ksywki nie psuły layoutu na tel */
}

.result-center {margin-top: 40px; display: flex; justify-content: center; width: 100%; max-width: 1200px;}
.loading {font-size: 20px; color: #9aa2ff; animation: pulse 1.5s infinite; text-align: center;}
@keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }

/* --- MOBILE CSS --- */
@media (max-width: 900px){
    .results-grid{grid-template-columns:repeat(2,1fr);}
}

@media (max-width: 600px){
    header h1 { font-size: 32px; }
    
    /* Na telefonie wyniki w 1 kolumnie - czytelniej */
    .results-grid{
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .result-card { padding: 20px; }
    .result-card h4 { font-size: 18px; }
    .result-card .winner { font-size: 22px; }
    
    .result-center { margin-top: 20px; }
}
</style>
</head>
<body>

<header>
    <h1>Hall Of Fame: Jezioro</h1>
    <p class="subtitle">Oficjalne Wyniki (TOP 1)</p>
</header>

<main class="results-hero">
    <div id="loading-msg" class="loading">Pobieranie głosów z bazy...</div>
    <div class="results-grid" id="results-grid"></div>
    <div class="result-center" id="result-center"></div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
// --- TU WKLEJ SWOJE DANE FIREBASE ---
const firebaseConfig = {
  apiKey: "TU_WKLEJ_API_KEY",
  authDomain: "TU_WKLEJ_PROJECT_ID.firebaseapp.com",
  projectId: "TU_WKLEJ_PROJECT_ID",
  storageBucket: "TU_WKLEJ_PROJECT_ID.appspot.com",
  messagingSenderId: "TU_WKLEJ_SENDER_ID",
  appId: "TU_WKLEJ_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const categories = [
    {id: 1, title: "Kategoria I", sub: "Największy Brutal"},
    {id: 2, title: "Kategoria II", sub: "Cichy Brutal"},
    {id: 3, title: "Kategoria III", sub: "Największy Simp"},
    {id: 4, title: "Kategoria IV", sub: "Największy Najebus"},
    {id: 5, title: "Kategoria V", sub: "Największy Ćpun"},
    {id: 6, title: "Kategoria VI", sub: "Największy Troll"},
    {id: 7, title: "Kategoria VII", sub: "Największy Tyracz"},
    {id: 8, title: "Kategoria VIII", sub: "Największa Pizda"},
    {id: 9, title: "Kategoria IX", sub: "Największy Rajzownik"},
    {id: 10, title: "Kategoria X", sub: "Największy Wyjebus"},
    {id: 11, title: "Kategoria XI", sub: "Kto Najwięcej Wychodził"},
    {id: 12, title: "Kategoria XII", sub: "Największy Żul"},
    {id: 13, title: "Kategoria XIII", sub: "Największy Żyd"}
];

async function loadResults(){
    try {
        const snapshot = await db.collection("glosy").get();
        
        if (snapshot.empty) {
            document.getElementById('loading-msg').innerText = "Brak oddanych głosów w bazie.";
            return;
        }

        const aggregated = {};
        categories.forEach(c => aggregated[c.id] = {});

        snapshot.forEach(doc => {
            const data = doc.data();
            const votesArray = data.votes;
            if(votesArray && Array.isArray(votesArray)){
                votesArray.forEach(vote => {
                    if(aggregated[vote.roundId]){
                        const currentCount = aggregated[vote.roundId][vote.choice] || 0;
                        aggregated[vote.roundId][vote.choice] = currentCount + 1;
                    }
                });
            }
        });

        document.getElementById('loading-msg').style.display = 'none';

        const gridContainer = document.getElementById('results-grid');
        const centerContainer = document.getElementById('result-center');

        function getWinner(roundId) {
            const counts = aggregated[roundId];
            const candidates = Object.keys(counts);
            if(candidates.length === 0) return "Brak głosów";
            return candidates.reduce((a, b) => counts[a] >= counts[b] ? a : b);
        }

        for(let i=0; i<12; i++){
            const cat = categories[i];
            const winner = getWinner(cat.id);
            const count = aggregated[cat.id][winner] || 0;

            const card = document.createElement('div');
            card.className = "result-card";
            card.innerHTML = `
                <h3>${cat.title}</h3>
                <h4>${cat.sub}</h4>
                <div class="winner">${winner}</div>
                <div style="margin-top:10px; color:#666; font-size:12px;">Głosów: ${count}</div>
            `;
            gridContainer.appendChild(card);
        }

        const cat13 = categories[12];
        const winner13 = getWinner(cat13.id);
        const count13 = aggregated[cat13.id][winner13] || 0;

        const card13 = document.createElement('div');
        card13.className = "result-card";
        card13.style.width = "100%";
        card13.innerHTML = `
            <h3>${cat13.title}</h3>
            <h4>${cat13.sub}</h4>
            <div class="winner">${winner13}</div>
            <div style="margin-top:10px; color:#666; font-size:12px;">Głosów: ${count13}</div>
        `;
        centerContainer.appendChild(card13);

    } catch (error) {
        console.error("Błąd pobierania: ", error);
        document.getElementById('loading-msg').innerText = "Błąd pobierania danych. Sprawdź konsolę.";
    }
}

loadResults();
</script>
</body>
</html>
