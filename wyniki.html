<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plebiscyt - Wyniki TOP 1</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .result-card { background: #f4f4f4; padding: 20px; margin-top: 20px; border-left: 5px solid #007bff; }
        .winner-name { font-size: 1.5em; color: #007bff; font-weight: bold; }
        .vote-count { color: #666; }
    </style>
</head>
<body>

    <h1>Wyniki Plebiscytu (Top 1)</h1>
    <div id="results-container">Ładowanie wyników...</div>

    <br>
    <a href="index.html">Wróć do głosowania</a>
    <button onclick="clearVotes()" style="margin-left: 20px; color: red;">Resetuj moje głosy</button>

    <script>
        function renderResults() {
            const votes = JSON.parse(localStorage.getItem('plebiscyt_data')) || [];
            const container = document.getElementById('results-container');

            if (votes.length === 0) {
                container.innerHTML = "<p>Brak oddanych głosów. Musisz najpierw zagłosować!</p>";
                return;
            }

            // 1. Grupuj głosy: { "Kategoria": { "Osoba": liczba_glosow } }
            const stats = {};
            votes.forEach(v => {
                if (!stats[v.category]) stats[v.category] = {};
                stats[v.category][v.name] = (stats[v.category][v.name] || 0) + 1;
            });

            // 2. Wygeneruj HTML dla Top 1
            let finalHtml = "";
            for (const cat in stats) {
                const nominees = stats[cat];
                // Znajdź zwycięzcę kategorii
                const winner = Object.keys(nominees).reduce((a, b) => nominees[a] > nominees[b] ? a : b);
                
                finalHtml += `
                    <div class="result-card">
                        <h3>Kategoria: ${cat}</h3>
                        <p>Obecny lider:</p>
                        <div class="winner-name">${winner}</div>
                        <div class="vote-count">Liczba głosów: ${nominees[winner]}</div>
                    </div>
                `;
            }
            container.innerHTML = finalHtml;
        }

        function clearVotes() {
            if(confirm("Czy na pewno chcesz usunąć swoje głosy?")) {
                localStorage.removeItem('plebiscyt_data');
                location.reload();
            }
        }

        // Uruchom przy starcie
        renderResults();
    </script>
</body>
</html>
